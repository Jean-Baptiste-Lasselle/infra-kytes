#!/bin/bash
export KYTES_DOCKER_COMPOSE_HOME=../..
export MAISON=$(pwd)

# Ce script permet de construire un état initial, avant restauration, optimisé

# 1. L'initialisation iaac permet de télécharger toutes les images qui sont "buildées" hors de la VM, ou hors de l'infra Kytes (pour les images de tests).
#    Il est donc possible d faire les builds internes, pour que toutes les images, construites à l'extérieur, ou à l'intérieur, soient  prêtes, et qu'il n'y ait plus aucun build image à faire pour une restauration optimisée.


cd $KYTES_DOCKER_COMPOSE_HOME
# pour se placer le ./.env à la racine du repo, comme le docker-compose.yml, dans le contexte du docker-compose build 
# On pourrait aussi définir un ./.env dans le répertoire ./exeploitation/restauration, mais je préfère rester avec un eul et unique fichier d'environnement.
docker-compose config
# cf. https://docs.docker.com/compose/reference/config/

docker-compose build

cd $MAISON

docker images

# - 
# On ne fera pas ici de :
# - 
# docker-compose build --rmi all
# - 
# Car sinon, on détruirait TOUTES les images, y compris celles téléchargées de l'extérieur, alors 
# qu'on les a déjà téléchargées avec '../initialisation-iaac.sh'
# - 
# 
