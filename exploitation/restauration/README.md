# Principe

Cette recette suppose que la cible de restauration est dans l'état suivant : 
  * CentOS7 est installé, 
  * Un utilisateur linux adminsitrateur est existant dans le CentOS 7, à disposition pour l'opérateur de l'équipe IAAS-to-SAAS
  * L'horodatage système est mis en oeuvre avec configuration service NTP
  * `docker` et `docker-compose` son installés.
  * `git`, `zip` et `unzip` sont installés.

# Utilisation

À exécuter sur le poste opérateur : 

```bash
# - 
# d'abord, il faut s'assurer que l'horodatage système est bien synchronisé
# sur le serveur NTP principal configuré dans [/etc/ntp.conf]
# - 
# L'horodatage de la présente
# - 
export HORODATAGE_OPS=$(date '+%Y-%m-%dday_%Hh-%Mmin-%Ssec')
export OPERATIONS_HOME=/kytes-ops/restaurations/$HORODATAGE_OPS/


# L'URI du repo Git de versionning de la recette de provision
export URI_RECETTE_PROVISION_KYTES=https://github.com/Jean-Baptiste-Lasselle/infra-kytes
export URI_RECETTE_RESTAURATION_KYTES=https://github.com/Jean-Baptiste-Lasselle/infra-kytes
# l'utilisateur linux, opérateur légitime sur la machine cible
export USER_LX_OPERATEUR_SERVEUR_DISTANT=jibl
# le nom de l'hôte réseau de la machine cible
export NOM_HOTE_RESEAU_SERVEUR_DISTANT=production-docker-host-1.kytes.io

# ------------------ #
# --- OPERATIONS --- #
# ------------------ #

if [ -d $OPERATIONS_HOME ]; then echo "C'est inattendu, mais [$OPERATIONS_HOME] existe déjà"; sudo rm -rf $OPERATIONS_HOME; fi;
mkdir -p $OPERATIONS_HOME

cd $OPERATIONS_HOME

git clone "$URI_RECETTE_RESTAURATION_KYTES" .
chmod +x ./*.sh
chmod +x ./exploitation/*.sh
chmod +x ./exploitation/restauration/partie-poste-operateur.sh
./exploitation/restauration/partie-poste-operateur.sh $URI_RECETTE_PROVISION_KYTES $URI_RECETTE_RESTAURATION_KYTES


```

