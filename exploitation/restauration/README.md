# Principe

CEtte recette suppose :
* que la cible de restauration est dans l'état suivant : 
  * CentOS7 est installé, 
  * un utilisateur linux adminsitrateur est existant dans le CentOS 7
  * l'horodatage système est en place avec configuration service NTP
  * Docker et Docker Compose son installés

# Utilisation

À exécuter sur le poste opérateur : 

```bash
# - 
# d'abord, il faut s'assurer que l'horodatage système est bien synchronisé
# sur le serveur NTP principal configuré dans [/etc/ntp.conf]
# - 
# L'horodatage de la présente
# - 
export HORODATAGE_OPS=$(date '+%Y-%m-%dday_%Hh-%Mmin-%Ssec')
export OPERATIONS_HOME=/kytes-ops/restaurations/$HORODATAGE_OPS/


# L'URI du repo Git de versionning de la recette de provision
export URI_RECETTE_PROVISION_KYTES=https://github.com/Jean-Baptiste-Lasselle/infra-kytes

# l'utilisateur linux, opérateur légitime sur la machine cible
export USER_LX_OPERATEUR_SERVEUR_DISTANT=jibl
# le nom de l'hôte réseau de la machine cible
export NOM_HOTE_RESEAU_SERVEUR_DISTANT=production-docker-host-1.kytes.io

# UUID du disque dur externe contenant le backup à partir duquel on va faire la restauration
# Ce disque dur externe doit être connecté sur le poste matériel de l'opérateur
export UUID_DE_MON_DISQUE_DUR_EXTERNE=70BE639EBE635B9A
export CHEMIN_MAISON_KYTES_DRP=/media/jbl/disque/dur/externe/pour/bckups/kytes-bckup-storage-$HORODATAGE_OPS

export REPERTOIRE_EXPLOITATION_KYTES_DANS_SERVEUR=/home/jibl/infra-kytes


if [ -d $OPERATIONS_HOME ]; then echo "C'est inattendu, mais [$OPERATIONS_HOME] existe déjà"; sudo rm -rf $OPERATIONS_HOME; fi;
sudo mkdir -p $OPERATIONS_HOME

cd $OPERATIONS_HOME

# 0./ je remonte le disuqe dur externe DRP
./monter.sh
# 1./ je récupère le zip, et l'envoi sur le serveur
scp 

# 2./ sur le serveur, j'exécute la restauration à partir du zip envoyé



```

À exécuter sur la machine cible : 

```bash
# - 
# d'abord, il faut s'assurer que l'horodatage système est bien synchronisé
# sur le serveur NTP principal configuré dans [/etc/ntp.conf]
# - 
# L'horodatage de la présente
# - 
export HORODATAGE_OPS=$(date '+%Y-%m-%dday_%Hh-%Mmin-%Ssec')
export OPERATIONS_HOME=/kytes-ops/restaurations/$HORODATAGE_OPS/


# L'URI du repo Git de versionning de la recette de provision
export URI_RECETTE_PROVISION_KYTES=https://github.com/Jean-Baptiste-Lasselle/infra-kytes

# l'utilisateur linux, opérateur légitime sur la machine cible
export USER_LX_OPERATEUR_SERVEUR_DISTANT=jibl
# le nom de l'hôte réseau de la machine cible
export NOM_HOTE_RESEAU_SERVEUR_DISTANT=production-docker-host-1.kytes.io

# UUID du disque dur externe contenant le backup à partir duquel on va faire la restauration
# Ce disque dur externe doit être connecté sur le poste matériel de l'opérateur
export UUID_DE_MON_DISQUE_DUR_EXTERNE=70BE639EBE635B9A
export CHEMIN_MAISON_KYTES_DRP=/media/jbl/disque/dur/externe/pour/bckups/kytes-bckup-storage-$HORODATAGE_OPS

export REPERTOIRE_EXPLOITATION_KYTES_DANS_SERVEUR=/home/jibl/infra-kytes


if [ -d $OPERATIONS_HOME ]; then echo "Cest inattendu, mais [$OPERATIONS_HOME] existe déjà"; sudo rm -rf $OPERATIONS_HOME; fi;
sudo mkdir -p $OPERATIONS_HOME

cd $OPERATIONS_HOME
git clone "URI_RECETTE_PROVISION_KYTES" .
chmod +x ./*.sh
chmod +x exploitation/*.sh
chmod +x exploitation/restauration/*.sh


cd $OPERATIONS_HOME

```

# 
